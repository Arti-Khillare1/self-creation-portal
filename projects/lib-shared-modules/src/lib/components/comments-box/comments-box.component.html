<body>
  <section class="comment-open" *ngIf="!chatFlag">
    <div class="flex justify-between mr-10">
      <mat-icon class="mr-2">chat</mat-icon>
      <p>{{"ADD_REVIEW_COMMENTS" | translate}}</p>
    </div>
    <mat-icon *ngIf="!chatFlag" (click)="openChatBot()">open_in_full</mat-icon>
  </section>
  <div *ngIf="chatFlag" class="chatbox">
    <section class="header">
      <div class="flex justify-between">
        <mat-icon class="mr-5">chat</mat-icon>
        <p>{{"ADD_REVIEW_COMMENTS" | translate}}</p>
      </div>
      <div>
        <mat-icon *ngIf="chatFlag" (click)="openChatBot()">expand_circle_down</mat-icon>
      </div>
    </section>
    @if(mode !== "review"){
      <section class="flex justify-between items-center p-3 bg-white">
        <p>Comments by {{messages[0]?.commenter?.name}}</p>
        <!-- [0] represents the reviewer initiates the message, so the reviewer with be the commenter -->
        <button class="btn mr-5 save-button" [ngClass]="{'button-disabled': resolveDisable}" mat-flat-button [disabled]="resolveDisable" (click)="resolveComment()">Resolve</button>
      </section>
    }
    @if(messages?.length){
      <section class="p-3 chat-window z-[100]">
        @for(message of messages; track message; let i = $index) {
          <section>
            <div class="flex justify-center">
              <p class="text-center date-stamp my-3">{{message?.created_at | date : 'mediumDate'}}</p>
            </div>
            <div class="flex w-50 message-container" [ngClass]="{'sender-message': message?.commenter.id != userId}">
              <div class="message-body p-3" [ngClass]="{'sender-message-body': message?.commenter.id != userId}">
                <p [innerHTML]="message?.comment"></p>
                <p class="text-end">{{message?.created_at | date : 'shortTime'}}</p>
              </div>
              <p class="text-end color-primary my-2 resolve-text" *ngIf="message?.resolved_at">Resolved<mat-icon class="mr-5">check_circle</mat-icon></p>
            </div>
          </section>
        }
      </section>
    }
    <section>
      <quill-editor [(ngModel)]="quillInput" placeholder="Type your comment" [modules]="quillConfig"
        (onSelectionChanged)="onSelectionChanged($event)"></quill-editor>
    </section>
    <section class="flex justify-end p-1">
      <button class="btn button-enable mr-5 save-button" mat-flat-button (click)="saveComment()">Save</button>
    </section>
  </div>
</body>
