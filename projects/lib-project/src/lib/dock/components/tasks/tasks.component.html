<div class="main flex">
    <div class="w-full">
        <div color="secondary" class="border-b px-10 py-2 text-lg text-tertiary ">
            <span>{{"TASKS" | translate}}</span>
        </div>
        <div class="px-10 my-5 text-tertiary">
            <p>{{"TASK_DESCRIPTION" | translate}}</p>
        </div>
        <form [formGroup]="tasksForm" (ngSubmit)="submit()">
            <div formArrayName="tasks">
                @for(task of tasks.controls; track task; let i = $index){
                <div [formGroupName]="i" class="px-10">
                    <div>
                        <div class="w-full pt-3">
                            <div class="flex justify-between">
                                <p class="text-tertiary ">{{"TASK" | translate}} {{i+1}}
                                    @if(i == 0){
                                        <span class="asterisk">*</span>
                                    } 
                                </p>
                                <div class="flex gap-3">
                                    <div>
                                        <mat-icon (click)="this.moveTask(i, -1)" class="cursor-pointer" [ngClass]="{'disabled-with-pointer-event': i<1}" [matTooltip]="SHIFT_TASK_UP | translate">arrow_upward</mat-icon>
                                        <mat-icon (click)="this.moveTask(i, 1)" class="cursor-pointer" [ngClass]="{'disabled-with-pointer-event': i>=tasks.controls.length-1}" [matTooltip]="SHIFT_TASK_DOWN | translate">arrow_downward</mat-icon>
                                    </div>
                                    <div>
                                        <mat-icon color="warn" class="cursor-pointer" (click)="tasks.controls.length > 1 ? deleteTask(i) : null" [ngClass]="{'disabled-with-pointer-event': tasks.controls.length <= 1}" >delete_outline</mat-icon>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <mat-form-field floatLabel="always" class="w-full" appearance="outline">
                                <textarea matInput [formControlName]="tasksData.description.name"
                                    [placeholder]="tasksData.description.placeholder" [maxlength]="tasksData.description.validators.maxLength"></textarea>
                            </mat-form-field>
                        </div>
                        <div class="sm:flex md:flex lg:flex xl:flex gap-2 text-tertiary">
                            <mat-slide-toggle labelPosition="before" color="primary"
                                [formControlName]="tasksData.mandatory.name">
                                {{tasksData.mandatory.label | translate}}
                            </mat-slide-toggle>

                            <mat-slide-toggle labelPosition="before" color="primary"
                                [formControlName]="tasksData.allowEvidence.name">
                                {{tasksData.allowEvidence.label | translate}}
                            </mat-slide-toggle>

                            <div class="border px-2 w-40 text-center" [ngClass]="{'disabled-with-pointer-events': !task.get(tasksData?.allowEvidence.name)?.value}" formGroupName="evidence_details">
                                <mat-select multiple="true" [formControlName]="tasksData.fileType.name" [disabled]="!task.get(tasksData?.allowEvidence.name)?.value" placeholder="All file types">
                                    <mat-option *ngFor="let option of tasksData.fileType.options" [value]="option">
                                        {{ option }}
                                    </mat-option>
                                </mat-select>                         
                            </div>
                            <div class="flex gap-2" [ngClass]="{'disabled-with-pointer-event': !task.get(tasksData?.allowEvidence.name)?.value}" formGroupName="evidence_details" >
                                <p class="text-tertiary">{{tasksData.minEvidences.label | translate}}</p>
                                    <input matInput [formControlName]="tasksData.minEvidences.name" [disabled]="!task.get(tasksData?.allowEvidence.name)?.value" placeholder="1"
                                        type="number" min="1"  class="w-14 block border text-center" />
                            </div>
                        </div>
                    </div>
                </div>
                }

            </div>
            
            <div class="px-10 py-2">
                <button (click)="addingTask()" type="button"  [ngClass]="{'disable-fields': (tasks.length>=maxTaskLength || !tasksForm.valid )}" mat-raised-button class="flex items-center button">
                    <mat-icon class="cursor-pointer" color="primary">add_circle</mat-icon>
                    <span color="primary">{{"ADD_TASK" | translate}}</span>
                </button>
            </div>
        </form>
    </div>
</div>
